# Example Web Server Configuration (.conf)
# Ref: https://nginx.org/en/docs/beginners_guide.html

# Server 1: Default server for port 80
# Handles requests to example.com and www.example.com
server {
    listen 8080; # Listen on port 80 for all interfaces
    server_name example.com www.example.com;
    client_max_body_size 8M; # Default max body size for this server

    error_page 404 /errors/404_custom.html;
    error_page 500 /errors/50x_custom.html;

    # Default location: Serve static files from /var/www/example.com
    location / {
        root /var/www/example.com;
        index index.html index.htm;
        allow_methods GET HEAD; # Only allow GET and HEAD requests here
    }

    # Location for static images with directory listing enabled
    location /images/ {
        root /var/www/example.com/assets;
        autoindex on; # Enable directory listing if index file not found
        allow_methods GET HEAD;
    }

    # Location for PHP CGI scripts
    location /scripts/ {
        root /var/www/cgi-bin;
        allow_methods GET POST; # Allow GET and POST for scripts
        cgi_pass /usr/bin/php-cgi; # Path to PHP CGI executable
        cgi_ext.php;            # Execute files ending in.php
    }

    # Location for handling file uploads
    location /upload/ {
        allow_methods POST;           # Only allow POST for uploads
        accept_uploads on;            # Enable uploads
        upload_path /mnt/uploads/example_com; # Directory to save uploads
        client_max_body_size 50M;     # Increase max size for this location
    }

    # Location demonstrating a permanent redirect
    location /old-page.html {
        return 301 http://example.com/new-page.html;
    }
}

# Server 2: Handles requests for api.example.com on port 80
server {
    listen 8081; # Also listens on port 80
    server_name api.example.com;

    # API endpoint using Python CGI
    location / {
        root /var/www/api;
        allow_methods GET POST;
        index api_handler.py; # Default script to execute if '/' is requested
        cgi_pass /usr/bin/python; # Path to Python interpreter
        cgi_ext.py;             # Execute files ending in.py
    }
}

# # Server 3: Listens on a different port (8080) for internal services
# server {
#     listen 127.0.0.1:8080; # Listen only on localhost, port 8080
#     # No server_name, acts as default for 127.0.0.1:8080

#     location /status {
#         root /var/www/status_app;
#         index status.html;
#         allow_methods GET;
#     }
# }